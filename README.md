# React Router Application с защищенными маршрутами

## Цель репозитория

Этот проект создан для изучения и демонстрации работы с **React Router DOM v7** - современной библиотекой маршрутизации для React-приложений. Проект демонстрирует реализацию полнофункционального веб-приложения с системой авторизации, защищенными маршрутами, вложенной навигацией и загрузкой данных.

**Зачем этот проект:**
- Изучение современных возможностей React Router DOM v7
- Практика реализации системы авторизации и защиты маршрутов
- Демонстрация декомпозиции и организации кода в React-приложении
- Пример использования компонентов форм из предыдущих уроков
- Понимание работы loaders, protected routes и nested routes

## Решаемая задача

### Функциональные требования

Проект реализует следующие функциональные требования:

1. **Система авторизации**
   - Страница входа с валидацией учетных данных
   - Хранение состояния авторизации в localStorage
   - Автоматический редирект после успешной авторизации

2. **Защита маршрутов (Private Routes)**
   - Страницы категории и детальной страницы доступны только после авторизации
   - Автоматический редирект на страницу входа при попытке доступа без авторизации
   - Сохранение исходного пути для возврата после авторизации

3. **Многоуровневая маршрутизация**
   - Главная страница с навигацией
   - Dashboard с вложенными страницами (Profile, Settings, Stats)
   - Страница списка персонажей с сортировкой
   - Детальная страница персонажа

4. **Загрузка данных**
   - Использование loaders для предзагрузки данных
   - Обработка ошибок при загрузке данных
   - Отображение демо-данных при недоступности API

### Проблема, которую решает проект

В современных веб-приложениях возникает необходимость:
- **Защищать контент от неавторизованного доступа** - не все страницы должны быть доступны всем пользователям
- **Организовывать сложную навигацию** - вложенные маршруты, вкладки, многоуровневая структура
- **Предзагружать данные** - показывать контент быстрее, загружая данные до рендеринга компонента
- **Обрабатывать ошибки маршрутизации** - корректно обрабатывать несуществующие страницы и ошибки загрузки

**Решение:** Использование React Router DOM v7 с:
- Защищенными маршрутами через `ProtectedRoute` и `loader` функции
- Вложенной маршрутизацией с `Outlet` и `NavLink`
- Loaders для предзагрузки данных и проверки авторизации
- Обработкой ошибок через Error Boundaries

## Структура репозитория

```
context_api1/
├── src/
│   ├── pages/                      # Все страницы приложения
│   │   ├── Home/                   # Главная страница
│   │   │   ├── Home.jsx
│   │   │   └── Home.css
│   │   ├── Login/                  # Страница входа
│   │   │   ├── Login.jsx
│   │   │   └── Login.css
│   │   ├── Dashboard/              # Dashboard с вложенными страницами
│   │   │   ├── Dashboard.jsx
│   │   │   ├── Dashboard.css
│   │   │   ├── Profile/            # Профиль пользователя
│   │   │   │   ├── Profile.jsx
│   │   │   │   └── Profile.css
│   │   │   ├── Settings/           # Настройки
│   │   │   │   ├── Settings.jsx
│   │   │   │   └── Settings.css
│   │   │   └── Stats/              # Статистика (загрузка данных с API)
│   │   │       ├── Stats.jsx
│   │   │       └── Stats.css
│   │   ├── Characters/             # Страница списка персонажей (приватная)
│   │   │   └── Characters.jsx
│   │   └── CharacterDetail/        # Детальная страница персонажа (приватная)
│   │       └── CharacterDetail.jsx
│   │
│   ├── components/                 # Переиспользуемые компоненты
│   │   ├── ProtectedRoute/         # Компонент защиты маршрутов
│   │   │   └── ProtectedRoute.jsx
│   │   ├── Input/                  # Компоненты форм из урока 4
│   │   │   ├── Input.jsx
│   │   │   ├── InputLabel.jsx
│   │   │   ├── InputError.jsx
│   │   │   ├── InputDescription.jsx
│   │   │   ├── InputWrapper.jsx
│   │   │   └── utils/
│   │   │       ├── inputConfig.js
│   │   │       └── useInputStyles.js
│   │   └── common/
│   │       ├── FormButton.jsx
│   │       └── FormButton.css
│   │
│   ├── routes/                     # Конфигурация маршрутизации
│   │   ├── router.jsx              # Главный файл роутера
│   │   └── loaders.js              # Loaders для защиты маршрутов
│   │
│   ├── data/                       # Статические данные
│   │   └── characters.json         # Данные персонажей
│   │
│   ├── styles/                     # Глобальные и общие стили
│   │   ├── index.css               # Глобальные стили
│   │   ├── CategoryPage.css        # Стили для страницы категории
│   │   └── DetailPage.css          # Стили для детальной страницы
│   │
│   └── main.jsx                    # Точка входа приложения
│
├── index.html                      # HTML шаблон
├── vite.config.js                  # Конфигурация Vite (порт 5174)
├── package.json                    # Зависимости и скрипты
├── README.md                       # Документация
└── STRUCTURE.md                    # Описание структуры проекта
```

### Описание модулей

#### `src/routes/router.jsx`
Главный файл конфигурации маршрутов. Использует `createBrowserRouter` и `createRoutesFromElements` для определения структуры маршрутов. Включает:
- Публичные маршруты: `/`, `/login`
- Защищенные маршруты: `/dashboard/*`, `/characters`, `/characters/:id`
- Вложенные маршруты внутри Dashboard

#### `src/routes/loaders.js`
Содержит `protectedLoader` - функцию для защиты маршрутов на уровне загрузки данных. Проверяет авторизацию и перенаправляет на страницу входа с сохранением исходного пути.

#### `src/components/ProtectedRoute/ProtectedRoute.jsx`
React-компонент для защиты маршрутов на уровне UI. Использует `Navigate` для редиректа неавторизованных пользователей.

#### `src/pages/Login/Login.jsx`
Страница авторизации с использованием компонентов форм (Input, FormButton) из урока 4. Валидирует учетные данные и сохраняет состояние авторизации в localStorage.

#### `src/pages/Dashboard/Dashboard.jsx`
Главный компонент Dashboard с навигацией через `NavLink` и выводом дочерних маршрутов через `Outlet`.

#### `src/pages/Characters/Characters.jsx`
Страница списка персонажей с сортировкой по дате создания. Использует URL search params для сохранения состояния сортировки.

#### `src/pages/CharacterDetail/CharacterDetail.jsx`
Детальная страница персонажа с полной информацией. Обрабатывает случай, когда персонаж не найден.

### Взаимодействие компонентов

1. **Поток авторизации:**
   ```
   Пользователь → /login → Ввод данных → Проверка → localStorage → Редирект на исходную страницу
   ```

2. **Защита маршрутов (двухуровневая):**
   - **На уровне loader:** `protectedLoader` проверяет авторизацию до загрузки страницы
   - **На уровне компонента:** `ProtectedRoute` дополнительно проверяет и редиректит при необходимости

3. **Вложенные маршруты:**
   ```
   /dashboard (Dashboard.jsx)
     ├── /dashboard/profile (Profile.jsx) - отображается через <Outlet />
     ├── /dashboard/settings (Settings.jsx)
     └── /dashboard/stats (Stats.jsx)
   ```

4. **Загрузка данных:**
   - Stats страница загружает данные с API через `useEffect`
   - При ошибке показываются демо-данные с уведомлением

## Как запустить

### Предварительные требования

- Node.js (версия 18 или выше)
- npm или yarn

### Установка зависимостей

```bash
npm install
```

### Запуск в режиме разработки

```bash
npm run dev
```

Приложение будет доступно по адресу `http://localhost:5174` (порт настроен в `vite.config.js`).

### Сборка для продакшена

```bash
npm run build
```

### Просмотр продакшен-сборки

```bash
npm run preview
```

## Как использовать и тестировать

### Шаг 1: Главная страница

1. Откройте приложение в браузере
2. Вы увидите приветственное сообщение на главной странице
3. Если вы не авторизованы, нажмите "Войти в систему"
4. Если уже авторизованы, увидите кнопки для перехода в Dashboard и к Персонажам

### Шаг 2: Вход в систему

1. Перейдите на страницу `/login`
2. Введите один из валидных аккаунтов:

**Валидные учетные данные:**
- Email: `admin@example.com`, Пароль: `admin123`
- Email: `user@example.com`, Пароль: `user123`
- Email: `test@test.com`, Пароль: `test`

3. После успешного входа произойдет автоматическое перенаправление на `/dashboard/profile`

### Шаг 3: Навигация по Dashboard

После авторизации вы можете переключаться между вкладками:
- **Profile** (`/dashboard/profile`) - отображает имя и email текущего пользователя
- **Settings** (`/dashboard/settings`) - форма для изменения имени пользователя (сохраняется в localStorage)
- **Stats** (`/dashboard/stats`) - загружает и отображает данные пользователя с внешнего API (jsonplaceholder.typicode.com)

### Шаг 4: Страница персонажей

1. На главной странице нажмите "Персонажи" или перейдите на `/characters`
2. Увидите список персонажей с возможностью сортировки
3. Кликните на любого персонажа для просмотра детальной информации
4. На детальной странице можно вернуться назад

### Тестирование защиты маршрутов

1. **Выйдите из системы** (кнопка "Выйти" в Dashboard)
2. Попробуйте напрямую перейти на `/characters` или `/dashboard` (введите URL в адресной строке)
3. Должен произойти автоматический редирект на `/login` с сохранением исходного пути
4. После входа вы вернетесь на страницу, которую пытались открыть

### Проверка в DevTools

1. Откройте DevTools (F12) → Application → Local Storage
2. Увидите ключи: `isAuthenticated`, `userEmail`, `userName`
3. Удалите ключ `isAuthenticated` и попробуйте перейти на защищенную страницу
4. Произойдет редирект на `/login`

### Тестирование загрузки данных

1. Перейдите на вкладку Stats в Dashboard
2. Откройте DevTools → Network
3. Увидите запрос к `jsonplaceholder.typicode.com/users/1`
4. Если API недоступен, будут показаны демо-данные с уведомлением

## Важные детали реализации

### Двухуровневая защита маршрутов

Проект использует два уровня защиты для надежности:

1. **Loader уровень (`protectedLoader`):**
   ```javascript
   export function protectedLoader({ request }) {
     const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true'
     if (!isAuthenticated) {
       const url = new URL(request.url)
       return redirect(`/login?from=${encodeURIComponent(url.pathname)}`)
     }
     return null
   }
   ```
   - Выполняется **до** рендеринга компонента
   - Делает редирект через query параметр `from`
   - Более быстрая проверка на уровне роутера

2. **Компонент уровень (`ProtectedRoute`):**
   ```javascript
   if (!isAuthenticated) {
     return <Navigate to="/login" state={{ from: location }} replace />
   }
   ```
   - Дополнительная проверка в самом компоненте
   - Использует `location.state` для сохранения пути
   - Fallback на случай, если loader не сработал

### Хранение состояния авторизации

Авторизация хранится в `localStorage`:
- `isAuthenticated` - флаг авторизации (строка "true")
- `userEmail` - email пользователя
- `userName` - имя пользователя

**Важно:** В реальном приложении следует использовать более безопасные методы (JWT токены, httpOnly cookies).

### Обработка ошибок загрузки данных

Компонент Stats использует улучшенную обработку ошибок:
- При ошибке сети показываются демо-данные
- Отображается понятное сообщение об ошибке
- Есть кнопка для повторной попытки загрузки
- Пользователь видит информацию даже при недоступности API

### Использование компонентов форм

Страница Login использует компоненты из урока 4:
- `Input` - универсальный компонент ввода с валидацией
- `FormButton` - стилизованная кнопка формы
- Все компоненты поддерживают обработку ошибок и состояний

### Вложенная маршрутизация

Dashboard использует вложенную структуру маршрутов:
- `Outlet` - место для рендеринга дочерних маршрутов
- `NavLink` - навигационные ссылки с активным состоянием
- Индексный маршрут автоматически редиректит на `/dashboard/profile`

### Структура проекта

Проект организован по принципу функциональной декомпозиции:
- **pages/** - страницы приложения, каждая в своей папке
- **components/** - переиспользуемые компоненты
- **routes/** - конфигурация маршрутизации
- **data/** - статические данные
- **styles/** - глобальные стили

Это упрощает навигацию по коду и поддержку проекта.

## Технологии

- **React 19.0.0** - библиотека для создания UI
- **React Router DOM 7.0.0** - маршрутизация
- **Vite 5.4.2** - инструмент сборки и dev-сервер
- **@vitejs/plugin-react 4.3.1** - плагин Vite для React

## Что можно изучить из этого проекта

1. **React Router DOM v7** - современная маршрутизация с loaders и защитой
2. **Защита маршрутов** - реализация приватных страниц
3. **Вложенная маршрутизация** - организация сложной структуры навигации
4. **Loaders** - предзагрузка данных и проверка авторизации
5. **Декомпозиция кода** - правильная организация структуры проекта
6. **Обработка ошибок** - graceful degradation при недоступности API
7. **Компоненты форм** - использование переиспользуемых компонентов

## Дополнительная документация

См. также `STRUCTURE.md` для подробного описания структуры проекта.

## Лицензия

Учебный проект для изучения React Router DOM v7.
